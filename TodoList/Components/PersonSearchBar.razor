@using TodoList.ViewModels
@using TodoList.Data;
@using TodoList.Data.SqlDataAccess;



@inject IPersonDataAccess _personData;



<h3>PersonSearchBar</h3>

<div class="container-fluid ">
    <div class="row">
        @* Search Box *@
        <div class="col-sm-8">
            <form>
                <div class="form-group formContainer">
                    <div class="row my-2">
                        <div class="col-sm-2 text-right">
                            <label for="lastName">Last Name</label>
                        </div>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="lastNameInput" @bind-value="lastNameInput" />
                        </div>
                    </div>
                    <div class="row my-2">
                        <div class="col-sm-2 text-right">
                            <label for="firstName">First Name</label>
                        </div>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="firstNameInput" @bind-value="firstNameInput" />
                        </div>
                    </div>
                    <div class="row my-2">
                        <div class="col-sm-2 text-right">
                            <label for="email">Email</label>
                        </div>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="emailInput" />
                        </div>
                    </div>
                    <div class="row my-2">
                        <div class="col-sm-2 text-right">
                            <label for="birthday">Birth Day</label>
                        </div>
                        <div class="col-sm-10">
                            <input type="date" class="form-control" id="birthdayInput" />
                        </div>
                    </div>
                    <div class="row my-2">
                        <div class="col-sm-2 text-right">
        @* https://stackoverflow.com/questions/63429397/blazor-parent-component-unexpectedly-gets-reinitialized-after-onclick-event-in-c
         Alright, so here's my lesson in async programming for the day. Literally, I debugged this all day.
        Async calls return the task object aaaallll the way to the top of the call stack.
        This onclick code used to read "SearchPeople(firstNameInput, lastNameInput)."
        So, this fucker never waited on the returned Task before continuing to execute the code. 
        The method was executed, stuff happened, but the page was rendered before the peopleResults object 
        could be populated.

        In short, when calling async methods in the code block, make sure to await them as shown if it affects
        the way the component gets rendered.
        *@
                            <button class="btn btn-outline-primary" type="button" @onclick="(async () => await SearchPeople(firstNameInput, lastNameInput))">Search</button>
                        </div>
                        <div class="col-sm-10"></div>
                    </div>

                </div>
            </form>
        </div>
        @* End Search Box *@
    <div class="col-sm-4">
        @if(peopleResults == null)
        {
            <p>Results will show here...</p>
        }
        @if(peopleResults != null)
        {
            <PeopleList People="peopleResults"></PeopleList>
        }

    </div>
        
    </div>
    <div class="row">
        <div class="col-sm-2"></div>
        <div class="col-sm-10"></div>
    </div>
</div>





@code {
    //this will hold the first and last name field with a button and a list that returns the possible people given search parameters.

    private List<PersonModel> testPeopleList = new List<PersonModel>
    {
        new PersonModel { FirstName = "test1", LastName = "test2", PersonID = 12 },
        new PersonModel { FirstName = "test3", LastName = "test4", PersonID = 13 },
        new PersonModel { FirstName = "test5", LastName = "test6", PersonID = 14 },
    };

    private string lastNameInput = string.Empty;
    private string firstNameInput = string.Empty;

    private List<PersonModel> peopleResults {
        get;
        set; }

    private async Task SearchPeople(string firstName, string lastName)
    {
        peopleResults = await _personData.SearchPeopleByName(firstName, lastName);
    }

}
